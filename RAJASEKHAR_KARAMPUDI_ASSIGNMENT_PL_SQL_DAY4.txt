=========================================================
1. DML operations in PL/SQL with procedures and Exceptions.
Ans.
Example_1:
/*
Below script will create a procedure insert_emp, 
whenever this procedure is executed with valid parameters, it will insert a employee information into employee table.
*/

CREATE OR REPLACE PROCEDURE insert_emp(
        p_emp_name VARCHAR2,
        p_emp_dept VARCHAR2,
        p_sal NUMBER) AS
BEGIN    
    INSERT INTO Employee VALUES(emp_id_gen.NEXTVAL, p_emp_name, p_emp_dept, p_sal);
    DBMS_OUTPUT.PUT_LINE(p_emp_name || ' data inserted into employee.');
END;
/

EXECUTE insert_emp('Raj', 'IT', 1500);

Example_2:
/*
Below code will update the salary of the department given in the parameters to the amount given.
it will take two parameters 1 for department name, 2 for amount of hike.
If the department passed through arguments was invalid then the expetion will raises.
*/

CREATE OR REPLACE PROCEDURE update_sal(
        dept VARCHAR2,
        hike NUMBER) AS
        
        dept_not_found EXCEPTION;
BEGIN    
    UPDATE Employee SET SALARY = SALARY + hike WHERE dept_name = dept;
    IF SQL%FOUND THEN
    DBMS_OUTPUT.PUT_LINE(dept || ' Employees salary updated with '||hike);
    ELSE
    RAISE dept_not_found;
    END IF;
EXCEPTION
    WHEN dept_not_found THEN
    DBMS_OUTPUT.PUT_LINE('Employee data was not found.');
END;
/

EXECUTE update_sal('HR', 200);

Example_3:
/*
Below code will delete's the employee information from the table with the of the given employee id.
if the employee not found then it will throw an exception as defined.
*/
CREATE OR REPLACE PROCEDURE del_emp(e_id NUMBER) AS
    not_found EXCEPTION;
BEGIN
    DELETE FROM EMPLOYEE WHERE Emp_id = e_id;
    DELETE FROM EMPLOYEE WHERE Emp_id = 500;
    IF SQL%FOUND THEN
    DBMS_OUTPUT.PUT_LINE(e_id ||' Employee information removed from database.');
    ELSE
    RAISE not_found;
    END IF;
EXCEPTION
    WHEN not_found THEN
    DBMS_OUTPUT.PUT_LINE('Please check the id, there is no data belongs to this id.');
END;
/

EXECUTE del_emp(115);

=========================================================
2. Using procedures and Exceptions with Nested blocks.
Ans.
/*
Below code will create a procedure of math_table, it will one argument,
whenever a number value greater than 0 is entered in the input it will return the table of that number.
if the number is invalid then it will send an predefined error.
*/
CREATE OR REPLACE PROCEDURE math_table(tb_no VARCHAR2) AS
    L_Result NUMBER;
BEGIN
    DECLARE
        tb_val NUMBER;
    BEGIN
        tb_val := TO_NUMBER(tb_no);
    IF tb_no > 0 THEN
        FOR i IN 1..10 LOOP
        L_Result := tb_no * i;
        DBMS_OUTPUT.PUT_LINE(tb_no || ' * '|| i ||' = ' || L_Result);
        END LOOP;
    ELSE
        DBMS_OUTPUT.PUT_LINE('Value must be greater than 0.');
    END IF;
    END;
EXCEPTION
    WHEN VALUE_ERROR THEN
    DBMS_OUTPUT.PUT_LINE('Please enter a valid number, your input '||tb_no|| ' is not valid.');
END;
/

BEGIN
    math_table('RAJ');
END;

=========================================================
3. SELECT INTO in pl/sql along with procedures and Exceptions.
Ans.
CREATE OR REPLACE PROCEDURE dept_emp_info(dept VARCHAR2) AS
    L_Emp_id employee.emp_id%TYPE;
    L_Emp_name employee.emp_name%TYPE;
    L_Salary employee.salary%TYPE;

    CURSOR emp_cur IS SELECT Emp_id, Emp_name, Salary FROM Employee WHERE dept_name = dept;
    wrong_dept EXCEPTION;
BEGIN
    OPEN emp_cur;
    LOOP
    FETCH emp_cur INTO L_Emp_id, L_Emp_name, L_Salary;
    IF emp_cur%FOUND THEN
    DBMS_OUTPUT.PUT_LINE('Employee ID: ' ||L_Emp_id ||' Employee name: '|| L_Emp_name ||' Employee salary: '|| L_Salary);
    ELSE
    RAISE wrong_dept;
    END IF;
    EXIT WHEN emp_cur%NOTFOUND;
    END LOOP;
EXCEPTION
    WHEN wrong_dept THEN
    DBMS_OUTPUT.PUT_LINE('Invalid department id');
END;
/
=========================================================
4. Conditional statements.
Ans.
CREATE OR REPLACE PROCEDURE vaccination_cities(type_of_vaccine VARCHAR2) AS
    Vaccine_1 CONSTANT VARCHAR2(30) := 'COVAXIN';
    Vaccine_2 CONSTANT VARCHAR2(30) := 'COVISHIELD';
    TYPE tb_type IS TABLE OF VARCHAR2(50) INDEX BY BINARY_INTEGER;
    Vacination_center tb_type;
BEGIN
    Vacination_center(1) := 'DSNR';
    Vacination_center(2) := 'KOTI';
    Vacination_center(3) := 'UPPAL';
    Vacination_center(4) := 'Hitech_city';
    Vacination_center(5) := 'Jubli_hills';
    Vacination_center(6) := 'Banjara_hills';
    Vacination_center(7) := 'Kukatpalli';
    Vacination_center(8) := 'Patancheru';
    
    IF Vaccine_1 = type_of_vaccine THEN
        DBMS_OUTPUT.PUT_LINE(Vacination_center(2));
        DBMS_OUTPUT.PUT_LINE(Vacination_center(4));
        DBMS_OUTPUT.PUT_LINE(Vacination_center(6));
        DBMS_OUTPUT.PUT_LINE(Vacination_center(8));
    ELSIF Vaccine_2 = type_of_vaccine THEN
        DBMS_OUTPUT.PUT_LINE(Vacination_center(1));
        DBMS_OUTPUT.PUT_LINE(Vacination_center(3));
        DBMS_OUTPUT.PUT_LINE(Vacination_center(5));
        DBMS_OUTPUT.PUT_LINE(Vacination_center(7));
    ELSE
        DBMS_OUTPUT.PUT_LINE('Invalid vaccine type');
    END IF;
END;
/
=========================================================
5. Loops.
Ans.
CREATE OR REPLACE PROCEDURE item_in_stores(L_item NUMBER) AS

CURSOR stores_list IS SELECT STORE FROM STORE WHERE ITEM = L_item;
    store_no NUMBER;
BEGIN
    OPEN stores_list;
    LOOP
        FETCH stores_list INTO store_no;
        IF stores_list%FOUND THEN
            DBMS_OUTPUT.PUT_LINE(store_no);
        END IF;
        EXIT WHEN stores_list%NOTFOUND;
    END LOOP;
    CLOSE stores_list;
EXCEPTION
    WHEN NO_DATA_FOUND THEN
    DBMS_OUTPUT.PUT_LINE('Wrong item number, please check the item number and try again.');
END;
/
=========================================================
6. PL/SQL Record
Ans.
CREATE OR REPLACE PROCEDURE rec_ex AS
    TYPE L_interview IS RECORD(
        L_Candidate_id Interviews.candidate_id%TYPE,
        L_Name INTERVIEWS.NAME%TYPE,
        L_COMPANY_NAME INTERVIEWS.COMPANY_NAME%TYPE,
        L_INTERVIEW_DATE INTERVIEWS.INTERVIEW_DATE%TYPE,
        L_INTERVIEW_MODE INTERVIEWS.INTERVIEW_MODE%TYPE,
        L_INTERVIEW_STATUS INTERVIEWS.INTERVIEW_STATUS%TYPE
    );
    
    Interview_info L_interview;
BEGIN
    SELECT candidate_id, name, company_name, interview_date, interview_mode, interview_status
    INTO Interview_info.L_Candidate_id, Interview_info.L_Name, Interview_info.L_COMPANY_NAME, Interview_info.L_INTERVIEW_DATE,
    Interview_info.L_INTERVIEW_MODE, Interview_info.L_INTERVIEW_STATUS FROM INTERVIEWS WHERE candidate_id = 1;
    DBMS_OUTPUT.PUT_LINE('Candidate_id: ' || Interview_info.L_Candidate_id ||
                        ' Name: ' || Interview_info.L_Name ||
                        ' Company name: ' || Interview_info.L_COMPANY_NAME ||
                        ' Interview date: ' ||Interview_info.L_INTERVIEW_DATE ||
                        ' Interview mode: ' || Interview_info.L_INTERVIEW_MODE ||
                        ' Interview status: ' || Interview_info.L_INTERVIEW_STATUS);
END;
/
=========================================================
7. PL/SQL ROWTYPE
Ans.
CREATE OR REPLACE PROCEDURE emp_info(L_Emp_id NUMBER) AS
    emp_details Employee%ROWTYPE;
    invalid EXCEPTION;
    PRAGMA EXCEPTION_INIT(invalid, -06550);
BEGIN
    SELECT emp_name, dept_name, salary INTO emp_details.emp_name, emp_details.dept_name, emp_details.salary FROM Employee WHERE Emp_id = L_Emp_id;
    DBMS_OUTPUT.PUT_LINE(emp_details.emp_name || ' is working in ' || emp_details.dept_name ||' department, with a package of '||emp_details.salary);
EXCEPTION
    WHEN NO_DATA_FOUND THEN
        DBMS_OUTPUT.PUT_LINE('NO employees found belongs to the given id.');
    WHEN invalid THEN
        DBMS_OUTPUT.PUT_LINE('invalid employee id.');
END;
/
=========================================================
8. PL/SQL Tables
Ans.
CREATE OR REPLACE PROCEDURE selected_list AS
CURSOR selected_candidates IS SELECT Name FROM INTERVIEWS WHERE INTERVIEW_STATUS = 'Selected';
TYPE tb_type IS TABLE OF interviews.name%TYPE INDEX BY BINARY_INTEGER;
candidate_name tb_type;
i NUMBER;
BEGIN
    i := 1;
    OPEN selected_candidates;    
    LOOP
    FETCH selected_candidates INTO candidate_name(i);
    DBMS_OUTPUT.PUT_LINE(candidate_name(i));
    i := i+1;
    EXIT WHEN selected_candidates%NOTFOUND OR i > 4;
    END LOOP;
    CLOSE selected_candidates;
END;
/

exec selected_list;
=========================================================
9. Cursors.
Ans.
CREATE OR REPLACE PROCEDURE no_manager AS
CURSOR dept_cur IS SELECT DEPARTMENT_ID, DEPARTMENT_NAME, LOCATION_ID FROM DEPARTMENTS WHERE MANAGER_ID IS NULL;
L_dept_id NUMBER;
L_dept_name VARCHAR2(30);
L_location_id NUMBER;

BEGIN
    OPEN dept_cur;
    FOR i IN 1..10 LOOP
    FETCH dept_cur INTO L_dept_id, L_dept_name, L_location_id;
    DBMS_OUTPUT.PUT_LINE(L_dept_id || ' | ' ||L_dept_name || ' | ' ||L_location_id );
    END LOOP;
    CLOSE dept_cur;
EXCEPTION
    WHEN INVALID_CURSOR THEN
    DBMS_OUTPUT.PUT_LINE('Please check the cursor.');
END;
/
=========================================================
10. Types of Exceptions with examples.

=========================================================
11. Procedures without parameters.

=========================================================
12. Procedures with parameters.

=========================================================
