=========================================================
1. DML operations in PL/SQL with procedures and Exceptions.
Ans.
Example_1:
/*
Below script will create a procedure insert_emp, 
whenever this procedure is executed with valid parameters, it will insert a employee information into employee table.
*/

CREATE OR REPLACE PROCEDURE insert_emp(
        p_emp_name VARCHAR2,
        p_emp_dept VARCHAR2,
        p_sal NUMBER) AS
BEGIN    
    INSERT INTO Employee VALUES(emp_id_gen.NEXTVAL, p_emp_name, p_emp_dept, p_sal);
    DBMS_OUTPUT.PUT_LINE(p_emp_name || ' data inserted into employee.');
END;
/

EXECUTE insert_emp('Raj', 'IT', 1500);

Example_2:
/*
Below code will update the salary of the department given in the parameters to the amount given.
it will take two parameters 1 for department name, 2 for amount of hike.
If the department passed through arguments was invalid then the expetion will raises.
*/

CREATE OR REPLACE PROCEDURE update_sal(
        dept VARCHAR2,
        hike NUMBER) AS
        
        dept_not_found EXCEPTION;
BEGIN    
    UPDATE Employee SET SALARY = SALARY + hike WHERE dept_name = dept;
    IF SQL%FOUND THEN
    DBMS_OUTPUT.PUT_LINE(dept || ' Employees salary updated with '||hike);
    ELSE
    RAISE dept_not_found;
    END IF;
EXCEPTION
    WHEN dept_not_found THEN
    DBMS_OUTPUT.PUT_LINE('Employee data was not found.');
END;
/

EXECUTE update_sal('HR', 200);

Example_3:
/*
Below code will delete's the employee information from the table with the of the given employee id.
if the employee not found then it will throw an exception as defined.
*/
CREATE OR REPLACE PROCEDURE del_emp(e_id NUMBER) AS
    not_found EXCEPTION;
BEGIN
    DELETE FROM EMPLOYEE WHERE Emp_id = e_id;
    DELETE FROM EMPLOYEE WHERE Emp_id = 500;
    IF SQL%FOUND THEN
    DBMS_OUTPUT.PUT_LINE(e_id ||' Employee information removed from database.');
    ELSE
    RAISE not_found;
    END IF;
EXCEPTION
    WHEN not_found THEN
    DBMS_OUTPUT.PUT_LINE('Please check the id, there is no data belongs to this id.');
END;
/

EXECUTE del_emp(115);

=========================================================
2. Using procedures and Exceptions with Nested blocks.
Ans.
/*
Below code will create a procedure of math_table, it will one argument,
whenever a number value greater than 0 is entered in the input it will return the table of that number.
if the number is invalid then it will send an predefined error.
*/
CREATE OR REPLACE PROCEDURE math_table(tb_no VARCHAR2) AS
    L_Result NUMBER;
BEGIN
    DECLARE
        tb_val NUMBER;
    BEGIN
        tb_val := TO_NUMBER(tb_no);
    IF tb_no > 0 THEN
        FOR i IN 1..10 LOOP
        L_Result := tb_no * i;
        DBMS_OUTPUT.PUT_LINE(tb_no || ' * '|| i ||' = ' || L_Result);
        END LOOP;
    ELSE
        DBMS_OUTPUT.PUT_LINE('Value must be greater than 0.');
    END IF;
    END;
EXCEPTION
    WHEN VALUE_ERROR THEN
    DBMS_OUTPUT.PUT_LINE('Please enter a valid number, your input '||tb_no|| ' is not valid.');
END;
/

BEGIN
    math_table('RAJ');
END;

=========================================================
3. SELECT INTO in pl/sql along with procedures and Exceptions.
Ans.
/*
Below code will create a procedure for dept_emp_info with a parameter of dept name,
and it will creat a cursor for selecting employees information of the given department name,
Then in the execution block it will fetch all the employees info and stores it in the variables and prints the output,
If the department name passed to the procedure is not found in the database, it will go to the exception block and prints the message.
*/

Example:
CREATE OR REPLACE PROCEDURE dept_emp_info(dept VARCHAR2) AS
    L_Emp_id employee.emp_id%TYPE;
    L_Emp_name employee.emp_name%TYPE;
    L_Salary employee.salary%TYPE;

    CURSOR emp_cur IS SELECT Emp_id, Emp_name, Salary FROM Employee WHERE dept_name = dept;
    wrong_dept EXCEPTION;
BEGIN
    OPEN emp_cur;
    LOOP
    FETCH emp_cur INTO L_Emp_id, L_Emp_name, L_Salary;
    IF emp_cur%FOUND THEN
    DBMS_OUTPUT.PUT_LINE('Employee ID: ' ||L_Emp_id ||' Employee name: '|| L_Emp_name ||' Employee salary: '|| L_Salary);
    ELSE
    RAISE wrong_dept;
    END IF;
    EXIT WHEN emp_cur%NOTFOUND;
    END LOOP;
EXCEPTION
    WHEN wrong_dept THEN
    DBMS_OUTPUT.PUT_LINE('Invalid department id');
END;
/

BEGIN
    dept_info('HR');
END;

=========================================================
4. Conditional statements.
Ans.
/*
Below code will check the available cities for the passed vacination type from parameters.
*/

Example:
CREATE OR REPLACE PROCEDURE vaccination_cities(type_of_vaccine VARCHAR2) AS
    Vaccine_1 CONSTANT VARCHAR2(30) := 'COVAXIN';
    Vaccine_2 CONSTANT VARCHAR2(30) := 'COVISHIELD';
    TYPE tb_type IS TABLE OF VARCHAR2(50) INDEX BY BINARY_INTEGER;
    Vacination_center tb_type;
BEGIN
    Vacination_center(1) := 'DSNR';
    Vacination_center(2) := 'KOTI';
    Vacination_center(3) := 'UPPAL';
    Vacination_center(4) := 'Hitech_city';
    Vacination_center(5) := 'Jubli_hills';
    Vacination_center(6) := 'Banjara_hills';
    Vacination_center(7) := 'Kukatpalli';
    Vacination_center(8) := 'Patancheru';
    
    IF Vaccine_1 = type_of_vaccine THEN
        DBMS_OUTPUT.PUT_LINE(Vacination_center(2));
        DBMS_OUTPUT.PUT_LINE(Vacination_center(4));
        DBMS_OUTPUT.PUT_LINE(Vacination_center(6));
        DBMS_OUTPUT.PUT_LINE(Vacination_center(8));
    ELSIF Vaccine_2 = type_of_vaccine THEN
        DBMS_OUTPUT.PUT_LINE(Vacination_center(1));
        DBMS_OUTPUT.PUT_LINE(Vacination_center(3));
        DBMS_OUTPUT.PUT_LINE(Vacination_center(5));
        DBMS_OUTPUT.PUT_LINE(Vacination_center(7));
    ELSE
        DBMS_OUTPUT.PUT_LINE('Invalid vaccine type');
    END IF;
END;
/

EXEC vaccination_cities('COVAXIN');

=========================================================
5. Loops.
Ans.
/*
Below code will create a procedure for showing the list of stores having the provided item from parameter.
it will create a cursor with all the stores having that item using the given parameter.
then it will fetch the stores numbers into the variables.
and prints the message,
if the given item is not there in any store, it will go to the exception block and prints the error message.
*/

Example:
CREATE OR REPLACE PROCEDURE item_in_stores(L_item NUMBER) AS

CURSOR stores_list IS SELECT STORE FROM STORE WHERE ITEM = L_item;
    store_no NUMBER;
BEGIN
    OPEN stores_list;
    LOOP
        FETCH stores_list INTO store_no;
        IF stores_list%FOUND THEN
            DBMS_OUTPUT.PUT_LINE(store_no);
        END IF;
        EXIT WHEN stores_list%NOTFOUND;
    END LOOP;
    CLOSE stores_list;
EXCEPTION
    WHEN NO_DATA_FOUND THEN
    DBMS_OUTPUT.PUT_LINE('Wrong item number, please check the item number and try again.');
END;
/

EXECUTE item_in_stores(1001);

=========================================================
6. PL/SQL Record
Ans.
/*
following scritp will create a procedure with a record type for listing out the employee information.
and it will print the data in a table format.
*/

Example:
CREATE OR REPLACE PROCEDURE rec_ex AS
    TYPE L_interview IS RECORD(
        L_Candidate_id Interviews.candidate_id%TYPE,
        L_Name INTERVIEWS.NAME%TYPE,
        L_COMPANY_NAME INTERVIEWS.COMPANY_NAME%TYPE,
        L_INTERVIEW_DATE INTERVIEWS.INTERVIEW_DATE%TYPE,
        L_INTERVIEW_MODE INTERVIEWS.INTERVIEW_MODE%TYPE,
        L_INTERVIEW_STATUS INTERVIEWS.INTERVIEW_STATUS%TYPE
    );
    
    Interview_info L_interview;
BEGIN
    SELECT candidate_id, name, company_name, interview_date, interview_mode, interview_status
    INTO Interview_info.L_Candidate_id, Interview_info.L_Name, Interview_info.L_COMPANY_NAME, Interview_info.L_INTERVIEW_DATE,
    Interview_info.L_INTERVIEW_MODE, Interview_info.L_INTERVIEW_STATUS FROM INTERVIEWS WHERE candidate_id = 1;
    DBMS_OUTPUT.PUT_LINE('Candidate_id: ' || Interview_info.L_Candidate_id ||
                        ' Name: ' || Interview_info.L_Name ||
                        ' Company name: ' || Interview_info.L_COMPANY_NAME ||
                        ' Interview date: ' ||Interview_info.L_INTERVIEW_DATE ||
                        ' Interview mode: ' || Interview_info.L_INTERVIEW_MODE ||
                        ' Interview status: ' || Interview_info.L_INTERVIEW_STATUS);
END;
/

BEGIN
    rec_ex;
END;

=========================================================
7. PL/SQL ROWTYPE
Ans.
/*
Below example will take all the employee information from the employee id provided in parameter and stores it in a rowtype.
and prints the infromation in a proper manner,
if there is no such employee exists then it will send the error message.
*/

Example:
CREATE OR REPLACE PROCEDURE emp_info(L_Emp_id NUMBER) AS
    emp_details Employee%ROWTYPE;
    invalid EXCEPTION;
    PRAGMA EXCEPTION_INIT(invalid, -06550);
BEGIN
    SELECT emp_name, dept_name, salary INTO emp_details.emp_name, emp_details.dept_name, emp_details.salary FROM Employee WHERE Emp_id = L_Emp_id;
    DBMS_OUTPUT.PUT_LINE(emp_details.emp_name || ' is working in ' || emp_details.dept_name ||' department, with a package of '||emp_details.salary);
EXCEPTION
    WHEN NO_DATA_FOUND THEN
        DBMS_OUTPUT.PUT_LINE('NO employees found belongs to the given id.');
    WHEN invalid THEN
        DBMS_OUTPUT.PUT_LINE('invalid employee id.');
END;
/

EXECUTE emp_info(113);

=========================================================
8. PL/SQL Tables
Ans.
/*
Below example will create a procedure to list the candidates who are selected in the interviews,
it will create a cursor with all the candidates who are selected,
and then the data will be fetched into the vaiables.
then it will print the message.
*/
Exampel:
CREATE OR REPLACE PROCEDURE selected_list AS
CURSOR selected_candidates IS SELECT Name FROM INTERVIEWS WHERE INTERVIEW_STATUS = 'Selected';
TYPE tb_type IS TABLE OF interviews.name%TYPE INDEX BY BINARY_INTEGER;
candidate_name tb_type;
i NUMBER;
BEGIN
    i := 1;
    OPEN selected_candidates;    
    LOOP
    FETCH selected_candidates INTO candidate_name(i);
    DBMS_OUTPUT.PUT_LINE(candidate_name(i));
    i := i+1;
    EXIT WHEN selected_candidates%NOTFOUND OR i > 4;
    END LOOP;
    CLOSE selected_candidates;
END;
/

EXEC selected_list;

=========================================================
9. Cursors.
Ans.
/*
Below code create a procedure to check all the departments where there are no manager id's,
it will create a cursor and stores all the managers information,
then it will fetch the info using the loop and print the messages.
If any error occured while using the cursor it will execute the exception message.
*/

Example:
CREATE OR REPLACE PROCEDURE no_manager AS
CURSOR dept_cur IS SELECT DEPARTMENT_ID, DEPARTMENT_NAME, LOCATION_ID FROM DEPARTMENTS WHERE MANAGER_ID IS NULL;
L_dept_id NUMBER;
L_dept_name VARCHAR2(30);
L_location_id NUMBER;

BEGIN
    OPEN dept_cur;
    FOR i IN 1..10 LOOP
    FETCH dept_cur INTO L_dept_id, L_dept_name, L_location_id;
    DBMS_OUTPUT.PUT_LINE(L_dept_id || ' | ' ||L_dept_name || ' | ' ||L_location_id );
    END LOOP;
    CLOSE dept_cur;
EXCEPTION
    WHEN INVALID_CURSOR THEN
    DBMS_OUTPUT.PUT_LINE('Please check the cursor.');
END;
/

EXCE no_manager;

=========================================================
10. Types of Exceptions with examples.
Ans.
We have 3 tpyes of exception.
1. Predefined Exception
2. NON predefined exceptions
3. User-defined exceptions.

1. Predefined Exception are the Exceptions which are already declared by the oracle, we can directly access them by using the name of the error in the exception block,
here are the examples for predefined exceptions.

i. DUP_VAL_ON_INDEX
This exception will occur when duplicate values are trying to insert into a column which is having unique constraint.

Example:
BEGIN
INSERT INTO unique_check VALUES(1000);
EXCEPTION
WHEN DUP_VAL_ON_INDEX THEN
DBMS_OUTPUT.PUT_LINE('ALREADY EXISTS');
END;
/

ii. INVALID_CURSOR
This will occur when trying to perform cursor operation before opening.

Example:
DECLARE
CURSOR check_cur IS SELECT Emp_name FROM Employee WHERE Emp_id = 101;
L_Emp_name VARCHAR2(30);
BEGIN
FETCH check_cur INTO L_Emp_name;
EXCEPTION
WHEN INVALID_CURSOR THEN
DBMS_OUTPUT.PUT_LINE('Please open the cursor to access the data and close after using it.');
END;
/

iii. INVALID_NUMBER
This will occur when conversion of a character string into a number fails, because the string is not a valid number.

Example:
DECLARE
emp_id NUMBER;
Emp_name VARCHAR2(30) := 'RAJA';
BEGIN
insert into employee (emp_id) values('raja');
EXCEPTION
WHEN INVALID_NUMBER THEN
DBMS_OUTPUT.PUT_LINE('ENTER A VALID NUMBER.');
END;
/

iv. VALUE_ERROR
This will occure when arithmetic or conversion error occurs.

Example:
DECLARE
emp_id VARCHAR2(10);
BEGIN
emp_id := 'raja';
emp_id := TO_NUMBER(emp_id);
EXCEPTION
WHEN VALUE_ERROR THEN
DBMS_OUTPUT.PUT_LINE('ENTER A VALID NUMBER.');
END;
/

v. TOO_MANY_ROWS
It will return when a SELECT INTO statement returned more than one row.

Example:
DECLARE
L_emp_name VARCHAR2(30);
BEGIN
    SELECT Emp_name INTO L_emp_name FROM Employee;
EXCEPTION
WHEN TOO_MANY_ROWS THEN
DBMS_OUTPUT.PUT_LINE('Your statement returning more then requested rows.');
END;
/

vi. ZERO_DIVIDE
It will occur when trying to divide any value with 0.

Example:
BEGIN
    DBMS_OUTPUT.PUT_LINE(4/0);
EXCEPTION
WHEN ZERO_DiVIDE THEN
DBMS_OUTPUT.PUT_LINE('What is your school name bro, how can you devide something with 0');
END;
/

2. NON-predefined errors, these are the errors which are not declared by oracle, we can handle them by using the ora id.

Example:
BEGIN
    DBMS_OUTPUT.PUT_LINE('RAJ'+1);
EXCEPTION
    WHEN OTHERS THEN
    DBMS_OUTPUT.PUT_LINE('ERROR');
END;
/

3. User defined errors, these are the erros which are declared by users to rise an error when an action is occured.
DECLARE
    val NUMBER := 5;
    err EXCEPTION;
BEGIN
    IF val > 10 THEN
    DBMS_OUTPUT.PUT_LINE(val);
    ELSIF val < 6 THEN
    RAISE err;
    END IF;
EXCEPTION
    WHEN err THEN
    DBMS_OUTPUT.PUT_LINE('The input value is under 6, please enter a value above 6.');
END;
/

=========================================================
11. Procedures without parameters.
Ans.
/*
Below example will create a procedure to list the top 10 employees from the database,
it will create a cursor and stores the informtion of the all the employees,
then in the loop it will fetch the top 10 employees information and prints the values.
*/

Example:
CREATE OR REPLACE PROCEDURE emp_info AS
CURSOR all_emp IS SELECT * FROM Employee;
TYPE tb_of_record IS TABLE OF Employee%ROWTYPE INDEX BY BINARY_INTEGER;
emp_row tb_of_record;
i NUMBER := 1;
BEGIN
    OPEN all_emp;
    LOOP
        FETCH all_emp
        INTO emp_row(i).Emp_id, emp_row(i).Emp_name, emp_row(i).Dept_name, emp_row(i).Salary;
        DBMS_OUTPUT.PUT_LINE(emp_row(i).Emp_id || ' | ' ||emp_row(i).Emp_name || ' | ' || emp_row(i).Dept_name || ' | ' || emp_row(i).Salary );
        i := i+1;
    EXIT WHEN all_emp%notfound OR i > 10;
    END LOOP;
    CLOSE all_emp;
END;
/

EXEC emp_info;

=========================================================
12. Procedures with parameters.
Ans.
/*
Below example will create a procedure to delete the employee information from the database,
it will take  a parameter of employee id and deletes the employee data,
if there is no such employee exists, then the error message will pop up.
*/

Example:
CREATE OR REPLACE PROCEDURE del_emp(l_emp_id NUMBER) AS
    err EXCEPTION;
BEGIN
    DELETE FROM Employee WHERE emp_id = l_emp_id;
    IF SQL%FOUND THEN
        DBMS_OUTPUT.PUT_LINE(l_emp_id || ' information deleted from database.');
    ELSIF SQL%NOTFOUND THEN
        RAISE err;
    END IF;
EXCEPTION
    WHEN err THEN
    DBMS_OUTPUT.PUT_LINE('no employee with employee id ' || l_emp_id);
END;
/

EXEC del_emp(112);

=========================================================